/**
 * angular-feeds - v0.0.4 - 2017-01-11 12:31 PM
 * https://github.com/siddii/angular-feeds
 *
 * Copyright (c) 2017 
 * Licensed MIT <https://github.com/siddii/angular-feeds/blob/master/LICENSE.txt>
 */
"use strict";function feedService(a,b,c,d){function e(a){console.log(a);var c={},d=[{indexName:"content",possibleIndexNames:["content","description","summary"]},{indexName:"title",possibleIndexNames:["title"]},{indexName:"link",possibleIndexNames:["link"]}];return d.forEach(function(d){d.possibleIndexNames.forEach(function(e){if(a[e]){var f="string"==typeof a[e]?a[e]:a[e].content;f||(f=a[e].href),c[d.indexName]=b.trustAsHtml(f)}})}),c}function f(a){for(var b=[],c=0;c<a.length;c++)b.push(e(a[c]));return b}function g(b,e){function g(){try{YUI().use("yql",function(a){var d="select * from feed(0,"+e+') where url = "'+b+'"';a.YQL(d,function(a){if(console.log(a,b),a.query.count){var d="undefined"==typeof a.query.results.item?"entry":"item",e=a.query.results[d];c.set(b,e),j.resolve(f(e))}else j.resolve([])})})}catch(a){j.reject(a)}}var j=a.defer(),k=encodeURI(h)+encodeURIComponent(i+b);if(c.hasCache(k)){var l=c.get(k);j.resolve(f(l))}else e?d.load().then(g):console.warn("called getFeeds with count "+e);return j.promise}var h="http://query.yahooapis.com/v1/public/yql?q=",i="select * from rss where url=";return{getFeeds:g}}function feedCache(){function a(){return"CACHE_TIMES"in localStorage?angular.fromJson(localStorage.getItem("CACHE_TIMES")):{}}function b(b){var d=a();return b in d&&b in localStorage&&(new Date).getTime()-d[b]<c}var c=3e5;return{set:function(b,c){localStorage.setItem(b,angular.toJson(c));var d=a();d[b]=(new Date).getTime(),localStorage.setItem("CACHE_TIMES",angular.toJson(d))},get:function(a){return b(a)?angular.fromJson(localStorage.getItem(a)):null},hasCache:b}}function yui(){function a(a){function b(){var b=a.defer();if(d.push(b),!document.querySelector('[src*="http://yui.yahooapis.com/3.18.1/build/yui/yui-min.js"]')&&c){c=!1;var e=document.createElement("script");e.onload=function(){c=!0,d.forEach(function(a){a.resolve()})},e.src="http://yui.yahooapis.com/3.18.1/build/yui/yui-min.js",document.getElementsByTagName("head")[0].appendChild(e)}else c&&b.resolve();return b.promise}var c=!0,d=[];return b(),{load:b}}this.$get=["$q",a]}angular.module("feeds-directives",[]).directive("feed",["feedService","$compile","$templateCache","$http",function(a,b,c,d){return{restrict:"E",scope:{summary:"=summary"},controller:["$scope","$element","$attrs","$timeout",function(e,f,g,h){function i(a,c){if(f.append(b(a)(e)),c)for(var d=0;d<c.length;d++)e.feeds.push(c[d])}e.$watch("finishedLoading",function(a){g.postRender&&a&&h(function(){new Function("element",g.postRender+"(element);")(f)},0)}),e.feeds=[];var j=c.get("feed-spinner.html");f.append(b(j)(e)),g.$observe("url",function(b){a.getFeeds(b,g.count).then(function(a){g.templateUrl?d.get(g.templateUrl,{cache:c}).success(function(b){i(b,a)}):i(c.get("feed-list.html"),a)},function(a){console.error("Error loading feed ",a),e.error=a,i(c.get("feed-list.html"))})["finally"](function(){f.find(".spinner").slideUp(),e.$evalAsync("finishedLoading = true")})})}]}}]),angular.module("feeds",["feeds-services","feeds-directives"]),angular.module("feeds-services",[]),angular.module("feeds-services").factory("feedService",["$q","$sce","feedCache","yui",feedService]),angular.module("feeds-services").factory("feedCache",feedCache),angular.module("feeds-services").provider("yui",[yui]).run(["yui",function(a){}]),angular.module("feeds").run(["$templateCache",function(a){a.put("feed-list.html",'<div>\n    <div ng-show="error" class="alert alert-danger">\n        <h5 class="text-center">Oops... Something bad happened, please try later :(</h5>\n    </div>\n\n    <ul class="media-list">\n        <li ng-repeat="feed in feeds | orderBy:publishedDate:reverse" class="media">\n            <div class="media-body">\n                <h4 class="media-heading"><a target="_new" href="{{feed.link}}" ng-bind-html="feed.title"></a></h4>\n                <p ng-bind-html="!summary ? feed.content : feed.contentSnippet"></p>\n            </div>\n            <hr ng-if="!$last"/>\n        </li>\n    </ul>\n</div>'),a.put("feed-spinner.html",'<div class="spinner">\n    <div class="bar1"></div>\n    <div class="bar2"></div>\n    <div class="bar3"></div>\n    <div class="bar4"></div>\n    <div class="bar5"></div>\n    <div class="bar6"></div>\n    <div class="bar7"></div>\n    <div class="bar8"></div>\n</div>\n')}]);